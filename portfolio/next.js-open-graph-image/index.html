<!doctype html><style>html{height:100vh}body{min-height:100vh;display:grid;grid-template-rows:1fr auto}.footer{grid-row-start:2;grid-row-end:3}</style><html lang=en-gb><head><meta charset=utf-8><title>Sam Robbins</title><link rel=canonical href=https://samrobbins.uk/portfolio/next.js-open-graph-image/><meta name=viewport content="width=device-width,initial-scale=1"><meta name=monetization content="$ilp.uphold.com/reGxiLfZfUmn"><meta name=description property="og:description" content="A tool for generating open graph images made with Next.js"><meta name=image property="og:image" content="/"><meta name=author content="Sam Robbins"><meta name=generator content="Hugo 0.75.1"><link rel=stylesheet href=/css/syntax.min.css integrity media=screen><script src=https://cdn.jsdelivr.net/npm/mailgo@0.9.14/dist/mailgo.min.js defer></script><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link href=/css/tailwind.min.css rel=stylesheet><script defer src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js integrity=sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4 crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js integrity=sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa crossorigin=anonymous></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}]})})</script><script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "8348650db5154c01999667d263b7e6e1"}'></script></head><body class=portfolio><div class=wrapper><nav class="fixed h-16 p-4 bg-white border-b border-gray-200 w-full z-20"><div class="flex divide-x-4 divide-transparent pr-6 text-lg items-center text-gray-700"><a href=/ class=font-normal>Home</a>
<a href=/about/ title=About>About</a>
<a href=/blog/ title=Blog>Blog</a>
<a class="text-gray-800 font-semibold" href=/portfolio/ title=Portfolio>Portfolio</a>
<a href=/writing/ title=Writing>Writing</a></div></nav><section class="pt-20 px-4"><div class="container mx-auto"><h1 class="text-4xl text-center font-semibold">Next.js Open Graph Image</h1><p class="text-center text-gray-600 text-xl">A tool for generating open graph images made with Next.js</p><div class="py-4 text-gray-600"><p class=text-center><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentcolor" class="h-4 w-4 inline-block stroke-current text-gray-600"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5A2 2 0 003 7v12a2 2 0 002 2z"/></svg>Dec 06, 2020</p><p class=text-center><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentcolor" class="h-4 w-4 inline-block stroke-current text-gray-600"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3A9 9 0 113 12a9 9 0 0118 0z"/></svg>2 minutes</p></div><div class="flex justify-center gap-x-40 gap-y-4 flex-wrap"><div class="border border-gray-500 px-4 py-2 w-32"><a href=https://og.samrobbins.uk/><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentcolor" class="h-6 w-6 inline-block stroke-current text-gray-600"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657.0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657.0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"/></svg>Website</a></div></div><hr class=my-4><h2 class="text-center text-3xl">Built with</h2><section class="py-6 px-2"><div class=container><div class="flex justify-center gap-x-10 flex-wrap gap-y-4"><div><a href=https://pptr.dev/><img class="h-20 w-32 object-contain" src=https://res.cloudinary.com/samrobbins/image/upload/v1600618396/puppeteer_klfg7k.svg alt=Puppeteer loading=lazy style=cursor:pointer></a></div><div><a href=https://nextjs.org/><img class="h-20 w-32 object-contain" src=https://res.cloudinary.com/samrobbins/image/upload/v1597140056/next-black_csivx6.svg alt=Next.js loading=lazy style=cursor:pointer></a></div><div><a href=https://tailwindcss.com/><img class="h-20 w-32 object-contain" src=https://res.cloudinary.com/samrobbins/image/upload/v1597140224/tailwindcss_rnpshz.svg alt="Tailwind CSS" loading=lazy style=cursor:pointer></a></div></div></div></section><hr class=py-4></div></div></section><div class="container prose mx-auto w-screen px-4 pb-6"><p>This project was heavily inspired by<a href=https://og-image.now.sh/> og-image</a>, but I wanted to change it in a couple ways. For one the original architecture was somewhat confusing, so I wanted to write it in a way that makes it easy for me to customize it. I also wanted to make it with Next.js, which allows for greater expandability in the future</p><h1 id=api>API</h1><p>The place to start was the API, made easy with Next.js as you can just place the functions in the <code>api</code> folder. I wanted to create this as a dynamic API route as it makes the interface easier as the title can also be the route. To do this, I used the dynamic route feature of Next.js, by creating the file as <code>[title].js</code>. Within the function, I could then use the line</p><div class=highlight><pre class=chroma><code class=language-js data-lang=js><span class=kr>const</span> <span class=p>{</span>
  <span class=nx>query</span><span class=o>:</span> <span class=p>{</span> <span class=nx>title</span> <span class=p>},</span>
<span class=p>}</span> <span class=o>=</span> <span class=nx>req</span><span class=p>;</span>
</code></pre></div><p>And this allowd for me to use the <code>title</code> variable throughout the rest of my code, and it would be whatever was submitted.</p><p>Then came the actual capture of the image, for this I used puppeteer, but due to the size limitation of AWS lambda functions, I had to use the library <code>chrome-aws-lambda</code> which brotli compresses the chrome file in order for it to fit within the 50MB limit. An interesting future expansion on this project would be to use a library like <code>jimp</code> which would allow the image to be made using image processing rather then web development.</p><p>I also used an interesting library callefd <code>next-absolute-url</code>, which allowed me to fetch the URL of my deployment, with a fallback for localhost, allowing me to make the correct to the right place.</p><p>A customisation I wanted to make to Puppeteer was to change the viewport to the right size for an open graph image, from what I can tell 1200x627 is the recommended size, so I could do that using</p><div class=highlight><pre class=chroma><code class=language-js data-lang=js><span class=nx>await</span> <span class=nx>page</span><span class=p>.</span><span class=nx>setViewport</span><span class=p>({</span> <span class=nx>width</span><span class=o>:</span> <span class=mi>1200</span><span class=p>,</span> <span class=nx>height</span><span class=o>:</span> <span class=mi>627</span> <span class=p>});</span>
</code></pre></div><h1 id=page-to-take-a-screenshot-of>Page to take a screenshot of</h1><p>I also needed to create this page to screenshot, I used the same dynamic method as I did for the API, making the file <code>[title].js</code>, and a slightly different method for getting the query</p><div class=highlight><pre class=chroma><code class=language-js data-lang=js><span class=kr>const</span> <span class=nx>router</span> <span class=o>=</span> <span class=nx>useRouter</span><span class=p>();</span>
<span class=kr>const</span> <span class=p>{</span> <span class=nx>title</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>router</span><span class=p>.</span><span class=nx>query</span><span class=p>;</span>
</code></pre></div><p>I also wanted to implement a dark mode for the images, so used the new Tailwind CSS dark mode by applying <code>"dark"</code> as a class to the outermost div if <code>dark=true</code> was passed in as a query. I could then use classes like <code>dark:bg-black</code> to change the image. This query was then passed through from the API</p></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css integrity=sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X crossorigin=anonymous></div></body></html>